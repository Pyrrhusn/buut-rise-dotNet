@page "/admin/cruise_period"
@using MudBlazor
@using Rise.Client.Admins.Components
@using Rise.Client.Localization.Admins
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<AdminPageResources> Localizer
@using Rise.Client.Common
@using Rise.Shared.Users
@using Rise.Shared.TimeSlots
@using FluentValidation
@using Rise.Client.Common.Buttons
@attribute [Authorize(Roles = nameof(UserRole.Administrator))]

@layout AdminLayout

<MudStack Spacing="4" Class="mb-4">
  <MudText Typo="Typo.h2">@Localizer["CruisePeriods"]</MudText>
  <MudStack Row="true" AlignItems="AlignItems.Center">
    <MudToggleIconButton Toggled="@ShowPastPeriods" ToggledChanged="OnToggleChanged" Icon="@Icons.Material.Filled.Today"
      ToggledIcon="@Icons.Material.Filled.History" Color="Color.Primary" data-testid="period-toggle" />
    <MudText>@(ShowPastPeriods ? Localizer["Past"] : Localizer["Future"])</MudText>
  </MudStack>
</MudStack>

<AsyncData DataFetcher="@FetchCruisePeriods" @bind-Data="@CruisePeriods" T="List<CruisePeriodDetailedDto>"
  TestIdPrefix="cruise-periods-list" @ref="_asyncData">
  <MudStack Spacing="3">
    @foreach (var period in CruisePeriods)
    {
      <MudPaper Class="pa-4" Elevation="2">
        <MudStack>
          <MudText Typo="Typo.h5" data-testid="cruise-period-dates">
            @($"{Localizer["Period"]}: {period.Start:d} - {period.End:d}")
          </MudText>

          @if (!ShowPastPeriods)
          {
            <div class="d-flex justify-start">
              <PrimaryButton Class="mt-2" Style="min-width: 150px;" Href=@($"admin/cruise_period/{period.Id}/timeslots")>
                @Localizer["AddTimeSlot"]
              </PrimaryButton>
            </div>
          }
        </MudStack>
      </MudPaper>
    }
  </MudStack>
</AsyncData>